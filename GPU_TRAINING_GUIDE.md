# ğŸš€ LayoutMaster 8GPUè®­ç»ƒå®Œæ•´æŒ‡å—

## ğŸ¯ ç¡¬ä»¶é…ç½®
- **GPU**: 8x NVIDIA H20 (97GBæ˜¾å­˜/å¡)
- **æ€»æ˜¾å­˜**: 776GB
- **ä¼˜åŒ–**: ä¸“ä¸ºå¤§è§„æ¨¡è®­ç»ƒä¼˜åŒ–çš„é…ç½®

## ğŸƒâ€â™‚ï¸ å¿«é€Ÿå¯åŠ¨ (æ¨è)

### æ–¹æ³•1: ä¸€é”®å¯åŠ¨è„šæœ¬
```bash
cd /home/LayoutMaster
./start_training.sh
```

### æ–¹æ³•2: äº¤äº’å¼å¯åŠ¨
```bash
cd /home/LayoutMaster  
python train_multi_gpu.py
```

### æ–¹æ³•3: ç›´æ¥å¯åŠ¨
```bash
cd /home/LayoutMaster
CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7 python train.py --config config_data_action_head.json --mode train
```

## âš™ï¸ å¤šGPUä¼˜åŒ–é…ç½®

### å…³é”®é…ç½®å‚æ•°
```json
{
  "use_multi_gpu": true,
  "data": {
    "batch_size": 32,        // æ€»æ‰¹æ¬¡å¤§å° (æ¯GPU 4ä¸ªæ ·æœ¬)
    "num_workers": 32        // æ•°æ®åŠ è½½è¿›ç¨‹æ•°
  },
  "optimizer": {
    "lr": 4e-4              // 4xåŸºç¡€å­¦ä¹ ç‡ (é€‚åº”å¤šGPU)
  }
}
```

### æ€§èƒ½ä¼˜åŒ–è®¾ç½®
- **DataParallel**: è‡ªåŠ¨ä½¿ç”¨æ‰€æœ‰å¯ç”¨GPU
- **å¼‚æ­¥æ•°æ®åŠ è½½**: 32ä¸ªworkerè¿›ç¨‹
- **æ¢¯åº¦ç´¯ç§¯**: è‡ªåŠ¨å¤„ç†å¤§æ‰¹æ¬¡
- **å†…å­˜ä¼˜åŒ–**: è‡ªåŠ¨ç®¡ç†å¤šGPUæ˜¾å­˜

## ğŸ“Š è®­ç»ƒç›‘æ§

### å®æ—¶ç›‘æ§GPUçŠ¶æ€
```bash
# æ–¹æ³•1: å®æ—¶æ˜¾ç¤º
watch -n 1 nvidia-smi

# æ–¹æ³•2: ç®€åŒ–è¾“å‡º
watch -n 1 "nvidia-smi --query-gpu=index,utilization.gpu,memory.used,memory.total,temperature.gpu --format=csv,noheader"
```

### æŸ¥çœ‹è®­ç»ƒè¿›åº¦
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f logs/training_*.log

# æŸ¥çœ‹æ£€æŸ¥ç‚¹
ls -la checkpoints/
```

### GPUä½¿ç”¨ç‡ä¼˜åŒ–
- **ç›®æ ‡GPUåˆ©ç”¨ç‡**: 90-95%
- **æ˜¾å­˜ä½¿ç”¨ç‡**: 70-80% (ç•™å‡ºç¼“å†²)
- **æ¸©åº¦æ§åˆ¶**: <80Â°C

## ğŸ›ï¸ è¿è¡Œå‚æ•°è°ƒæ•´

### å¦‚æœæ˜¾å­˜ä¸è¶³
```bash
# å‡å°‘æ‰¹æ¬¡å¤§å°
# ä¿®æ”¹ config_data_action_head.json:
"batch_size": 16  # ä»32å‡å°‘åˆ°16
```

### å¦‚æœæƒ³è¦æ›´å¿«è®­ç»ƒ
```bash
# å¢åŠ å­¦ä¹ ç‡
"lr": 8e-4  # è¿›ä¸€æ­¥å¢åŠ å­¦ä¹ ç‡
```

### å¦‚æœé‡åˆ°æ•°æ®åŠ è½½ç“¶é¢ˆ
```bash
# å¢åŠ æ•°æ®åŠ è½½è¿›ç¨‹
"num_workers": 64  # å……åˆ†åˆ©ç”¨128æ ¸CPU
```

## ğŸ“ˆ é¢„æœŸæ€§èƒ½

### è®­ç»ƒé€Ÿåº¦ä¼°ç®—
- **å•ä¸ªepoch**: ~5-10åˆ†é’Ÿ (800ä¸ªè®­ç»ƒæ ·æœ¬)
- **100ä¸ªepochs**: ~8-16å°æ—¶
- **æ¯ç§’æ ·æœ¬æ•°**: ~2-4ä¸ªæ ·æœ¬/ç§’ (8GPUå¹¶è¡Œ)

### æ˜¾å­˜ä½¿ç”¨é¢„ä¼°
- **æ¯GPU**: ~40-60GB (97GBæ€»å®¹é‡)
- **æ¨¡å‹å¤§å°**: ~2-3GB
- **æ‰¹æ¬¡æ•°æ®**: ~30-40GB/GPU

## ğŸš¦ è®­ç»ƒçŠ¶æ€è¯´æ˜

### æ­£å¸¸è¿è¡Œæ ‡å¿—
```
âœ… ä½¿ç”¨ 8 ä¸ªGPUè¿›è¡Œè®­ç»ƒ
âœ… è®­ç»ƒæ•°æ®é›†åŒ…å« 800 ä¸ªæ ·æœ¬  
âœ… éªŒè¯æ•°æ®é›†åŒ…å« 200 ä¸ªæ ·æœ¬
âœ… GPUåˆ©ç”¨ç‡: 90%+
âœ… æŸå¤±å‡½æ•°ç¨³å®šä¸‹é™
```

### é—®é¢˜æ’æŸ¥
```
âŒ GPUåˆ©ç”¨ç‡ä½ (<50%) â†’ æ£€æŸ¥æ•°æ®åŠ è½½é€Ÿåº¦
âŒ æ˜¾å­˜æº¢å‡º â†’ å‡å°‘batch_size
âŒ æ¸©åº¦è¿‡é«˜ (>85Â°C) â†’ æ£€æŸ¥æ•£çƒ­/é™ä½åŠŸè€—
âŒ è®­ç»ƒé€Ÿåº¦æ…¢ â†’ å¢åŠ num_workers
```

## ğŸ’¾ æ£€æŸ¥ç‚¹ç®¡ç†

### è‡ªåŠ¨ä¿å­˜
- **æœ€ä½³æ¨¡å‹**: `checkpoints/best_model.pth`
- **å®šæœŸä¿å­˜**: æ¯10ä¸ªepochä¿å­˜ä¸€æ¬¡
- **æ–­ç‚¹ç»­è®­**: æ”¯æŒä»ä»»æ„æ£€æŸ¥ç‚¹æ¢å¤

### æ‰‹åŠ¨ä¿å­˜å’ŒåŠ è½½
```bash
# æ¢å¤è®­ç»ƒ
python train.py --config config_data_action_head.json --mode train --resume checkpoints/checkpoint_epoch_50.pth

# é¢„æµ‹æ¨¡å¼
python train.py --config config_data_action_head.json --mode predict --checkpoint checkpoints/best_model.pth --num_samples 20
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å¯åŠ¨å‰æ£€æŸ¥
```bash
# æ£€æŸ¥æ•°æ®
python test_data_loading.py

# æ£€æŸ¥GPUçŠ¶æ€
nvidia-smi

# ç¡®è®¤é…ç½®
cat config_data_action_head.json
```

### 2. è®­ç»ƒæœŸé—´
- å®šæœŸæŸ¥çœ‹GPUåˆ©ç”¨ç‡
- ç›‘æ§æŸå¤±å‡½æ•°å˜åŒ–  
- æ£€æŸ¥æ¨¡å‹è¾“å‡ºè´¨é‡
- ç¡®ä¿æ£€æŸ¥ç‚¹æ­£å¸¸ä¿å­˜

### 3. ä¼˜åŒ–å»ºè®®
- **ç¬¬ä¸€æ¬¡è¿è¡Œ**: ä½¿ç”¨é»˜è®¤é…ç½®
- **å¦‚æœè®­ç»ƒç¨³å®š**: å¯å¢åŠ batch_sizeåˆ°48-64
- **å¦‚æœæ˜¾å­˜å……è¶³**: å¯å¢åŠ æ¨¡å‹hidden_dim
- **å¦‚æœæ•°æ®ä¸°å¯Œ**: å¯å¢åŠ num_epochsåˆ°200

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **CUDAå†…å­˜ä¸è¶³**
   ```bash
   # è§£å†³æ–¹æ¡ˆï¼šå‡å°‘batch_size
   "batch_size": 16
   ```

2. **æ•°æ®åŠ è½½æ…¢**
   ```bash
   # è§£å†³æ–¹æ¡ˆï¼šå¢åŠ workeræ•°é‡
   "num_workers": 64
   ```

3. **æ¨¡å‹ä¸æ”¶æ•›**
   ```bash
   # è§£å†³æ–¹æ¡ˆï¼šè°ƒæ•´å­¦ä¹ ç‡
   "lr": 2e-4  # é™ä½å­¦ä¹ ç‡
   ```

4. **GPUåˆ©ç”¨ç‡ä½**
   ```bash
   # æ£€æŸ¥æ•°æ®ç®¡é“
   htop  # æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µ
   ```

## ğŸ‰ å¼€å§‹è®­ç»ƒï¼

ç°åœ¨ä½ å·²ç»å‡†å¤‡å¥½å¼€å§‹ä½¿ç”¨8GPUè¿›è¡ŒLayoutMasterè®­ç»ƒäº†ï¼š

```bash
cd /home/LayoutMaster
./start_training.sh
```

è®­ç»ƒæ„‰å¿«ï¼ğŸš€
